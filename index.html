<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ErisPulse - 异步机器人开发框架</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
</head>
<body>
    <!-- 加载动画 -->
    <div id="page-loader" class="page-loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">ErisPulse</div>
    </div>

    <!-- 导航栏 -->
    <nav class="navbar">
        <a href="assets/img/logo.png" class="logo" data-view="home">
            <img src="assets/img/logo.png" class="logo-icon" alt="ErisPulse">
            <span>ErisPulse</span>
        </a>

        <div class="nav-links">
            <a href="#" class="nav-link active" data-view="home">
                <i class="fas fa-home"></i> 首页
            </a>
            <a href="#" class="nav-link" data-view="market">
                <i class="fas fa-store"></i> 模块市场
            </a>
            <a href="#" class="nav-link" data-view="about">
                <i class="fas fa-heart"></i> 我们
            </a>
        </div>

        <button class="theme-toggle" id="theme-toggle">
            <i class="fas fa-moon"></i>
        </button>
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 首页视图 -->
        <div id="home-view" class="view-container active">
            <!-- 英雄区域 -->
            <section class="hero">
                <div class="hero-content">
                    <h1 class="hero-title">ErisPulse</h1>
                    <p class="hero-subtitle">高性能异步机器人开发框架</p>
                    <div class="hero-actions">
                        <a href="docs.html" class="btn btn-primary">
                            <i class="fas fa-book"></i> 开始使用
                        </a>
                    </div>
                </div>
            </section>

            <!-- 特性介绍 -->
            <section class="features">
                <div class="container">
                    <h2 class="section-title">核心特性</h2>
                    <p class="section-subtitle">ErisPulse 提供强大的开发工具和功能，让机器人开发更加高效和便捷</p>

                    <div class="features-grid">
                        <div class="feature-card animate-in">
                            <div class="feature-icon">
                                <i class="fas fa-cubes"></i>
                            </div>
                            <h3 class="feature-title">模块化架构</h3>
                            <p class="feature-description">
                                通过模块系统实现功能解耦，支持动态加载和热更新，开发者可以轻松扩展功能而不影响核心系统。
                            </p>
                        </div>

                        <div class="feature-card animate-in">
                            <div class="feature-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h3 class="feature-title">异步高性能</h3>
                            <p class="feature-description">
                                充分利用 Python 的异步特性，提供高效的事件驱动机制，确保高性能和低延迟的运行表现。
                            </p>
                        </div>

                        <div class="feature-card animate-in">
                            <div class="feature-icon">
                                <i class="fas fa-plug"></i>
                            </div>
                            <h3 class="feature-title">OneBot12高兼容</h3>
                            <p class="feature-description">
                                核心系统兼容 OneBot 12 标准，快速接入各种机器人平台。
                            </p>
                        </div>

                        <div class="feature-card animate-in">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3 class="feature-title">安全性保障</h3>
                            <p class="feature-description">
                                事务支持、配置快照、模块化日志和错误追踪，满足生产环境需求。
                            </p>
                        </div>

                        <div class="feature-card animate-in">
                            <div class="feature-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <h3 class="feature-title">优雅的API</h3>
                            <p class="feature-description">
                                链式调用DSL、类型提示和完整的文档，让代码更简洁易维护。
                            </p>
                        </div>

                        <div class="feature-card animate-in">
                            <div class="feature-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <h3 class="feature-title">开发者工具</h3>
                            <p class="feature-description">
                                内置 CLI 工具、模块热重载，提升开发效率。
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 统计数据 -->
            <section class="stats">
                <div class="container">
                    <h2 class="section-title">项目状态</h2>
                    <p class="section-subtitle">实时项目数据统计和社区贡献信息</p>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-modules">--</div>
                            <div class="stat-label">可用模块</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-number" id="adapter-count">--</div>
                            <div class="stat-label">平台适配器</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-number" id="cli-count">--</div>
                            <div class="stat-label">CLI扩展</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <!-- 模块市场视图 -->
        <div id="market-view" class="view-container">
            <div class="container market-container">
                <div class="market-header">
                    <h2 class="section-title">模块市场</h2>
                    <a href="legacy_mods.html" class="legacy-market-link">
                        <i class="fas fa-history"></i> 查看 1.x 模块源 [已废弃]
                    </a>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="搜索模块..." id="module-search">
                    </div>
                </div>

                <div class="module-categories">
                    <button class="category-btn active" data-category="all">全部模块</button>
                    <button class="category-btn" data-category="modules">功能模块</button>
                    <button class="category-btn" data-category="adapters">平台适配器</button>
                    <button class="category-btn" data-category="cli">CLI扩展</button>
                </div>

                <div class="module-grid" id="modules-grid">
                    <!-- 模块卡片将通过JavaScript动态生成 -->
                    <div class="module-card">
                        <div class="module-header">
                            <div class="module-icon">
                                <i class="fas fa-puzzle-piece"></i>
                            </div>
                            <div>
                                <h3 class="module-name">示例模块</h3>
                                <div class="module-version">v1.0.0</div>
                            </div>
                        </div>
                        <p class="module-desc">这是一个示例模块的描述信息，用于展示模块卡片的外观和布局。</p>
                        <div class="module-tags">
                            <span class="module-tag">示例</span>
                            <span class="module-tag">测试</span>
                        </div>
                        <div class="module-footer">
                            <div class="module-author">ErisPulse Team</div>
                            <div class="module-actions">
                                <button class="module-btn">
                                    <i class="fas fa-download"></i> 安装
                                </button>
                                <button class="module-btn">
                                    <i class="fas fa-book"></i> 文档
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 关于视图 -->
        <div id="about-view" class="view-container">
            <div class="container">
                <section class="contributors">
                    <div class="container">
                        <div class="stat-card">
                            <div class="stat-number" id="contributors-count">--</div>
                            <div class="stat-label">贡献者</div>
                        </div>
                        <p class="section-subtitle">感谢以下开发者为 ErisPulse 做出的贡献</p>

                        <div class="contributors-grid" id="contributors-container">
                            <!-- 贡献者头像将通过JavaScript动态生成 -->
                        </div>
                    </div>
                    <br><hr><br>
                    <p class="section-subtitle">ErisPulse 使用 MIT 开源协议，允许自由分发和修改。</p>
                    <div class="container" style="text-align: center">
                        <p>
                            关于ErisPulse的头像 | 一切版权归属原作者所有
                            <br><span>作者：げのげ</span>
                            <br><span>PID：96369911</span>
                            <br><span>UID：63887595</span>
                        </p>
                    </div>
                </section>
            </div>
        </div>

        <!-- 模块详情模态框 -->
        <div class="modal-overlay" id="module-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">模块详情</h3>
                    <button class="close-btn" id="close-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="module-modal-content">
                        <!-- 模块详情内容将通过JavaScript动态加载 -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>ErisPulse</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-home"></i> 项目主页</a></li>
                        <li><a href="#"><i class="fas fa-book"></i> 使用文档</a></li>
                        <li><a href="#"><i class="fas fa-download"></i> 版本发布</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>贡献与开发</h3>
                    <ul class="footer-links">
                        <li><a href="https://github.com/ErisPulse/ErisPulse/issues"><i class="fas fa-code"></i> 报告Issue</a></li>
                        <li><a href="https://github.com/ErisPulse/ErisPulse/pulls"><i class="fas fa-code-branch"></i> 提交PR</a></li>
                        <li><a href="https://github.com/ErisPulse/ErisPulse/discussions"><i class="fas fa-comments"></i> 讨论区</a></li>
                        <li><a href="https://github.com/ErisPulse/ErisPulse-Scaffold"><i class="fas fa-terminal"></i> CLI 脚手架</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>社交平台</h3>
                    <ul class="footer-links">
                        <li><a href="https://github.com/ErisPulse"><i class="fab fa-github"></i> GitHub</a></li>
                    </ul>
                </div>

            </div>

            <div class="copyright">
                &copy; 2025 ErisPulse Project | 开源许可证：MIT 
            </div>
        </div>
    </footer>

    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 隐藏加载动画
            setTimeout(() => {
                const loader = document.getElementById('page-loader');
                loader.classList.add('hidden');
                
                // 动画完成后移除元素
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 500);
            }, 200);

            // 主题切换
            const themeToggle = document.getElementById('theme-toggle');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            let currentTheme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');
            
            // 应用初始主题
            if (currentTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.documentElement.removeAttribute('data-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
            
            // 主题切换按钮事件
            themeToggle.addEventListener('click', () => {
                if (currentTheme === 'light') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    currentTheme = 'dark';
                } else {
                    document.documentElement.removeAttribute('data-theme');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                    currentTheme = 'light';
                }
                localStorage.setItem('theme', currentTheme);
            });

            // 视图切换逻辑
            const viewLinks = document.querySelectorAll('[data-view]');
            const viewContainers = document.querySelectorAll('.view-container');
            
            viewLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const view = this.getAttribute('data-view');
                    
                    // 更新导航栏活动状态
                    viewLinks.forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 切换视图
                    viewContainers.forEach(container => {
                        container.classList.remove('active');
                    });
                    document.getElementById(`${view}-view`).classList.add('active');
                    
                    // 滚动到顶部
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
            });

            // 模块市场功能
            let allModules = [];
            let allAdapters = [];
            let allCliExtensions = [];
            let activeCategory = 'all';
            let searchQuery = '';
            loadModuleData();
            
            // 加载模块数据
            async function loadModuleData() {
                try {
                    const response = await fetch('https://erisdev.com/packages.json');
                    if (!response.ok) throw new Error('模块API请求失败');
                    const data = await response.json();
                    
                    // 处理模块数据
                    allModules = Object.entries(data.modules || {}).map(([name, info]) => ({
                        name,
                        package: info.package,
                        version: info.version,
                        author: info.author,
                        description: info.description,
                        repository: info.repository,
                        official: info.official || false,
                        tags: info.tags || [],
                        type: 'module'
                    }));
                    
                    // 处理适配器
                    allAdapters = Object.entries(data.adapters || {}).map(([name, info]) => ({
                        name,
                        package: info.package,
                        version: info.version,
                        author: 'ErisPulse Team',
                        description: info.description,
                        repository: info.repository,
                        official: info.official || false,
                        tags: info.tags || [],
                        type: 'adapter'
                    }));
                    
                    // 处理CLI扩展
                    allCliExtensions = Object.entries(data.cli_extensions || {}).map(([name, info]) => ({
                        name,
                        package: info.package,
                        version: info.version,
                        author: info.author || 'ErisPulse Team',
                        description: info.description,
                        repository: info.repository,
                        official: info.official || false,
                        tags: info.tags || [],
                        type: 'cli',
                        command: info.command || []
                    }));
                    
                    // 更新统计数据
                    updateStats();
                    
                    // 渲染模块
                    renderModules();
                    
                    // 加载贡献者数据
                    loadContributors();
                    
                } catch (error) {
                    console.error('加载模块数据失败:', error);
                    showError('加载模块失败，请稍后再试');
                }
            }
            
            // 加载贡献者数据
            async function loadContributors() {
                try {
                    const response = await fetch('https://api.github.com/repos/ErisPulse/ErisPulse/contributors');
                    if (!response.ok) throw new Error('贡献者API请求失败');
                    const contributors = await response.json();
                    
                    // 更新贡献者数量
                    document.getElementById('contributors-count').textContent = contributors.length;
                    
                    // 渲染贡献者头像
                    const container = document.getElementById('contributors-container');
                    container.innerHTML = '';
                    
                    contributors.slice(0, 12).forEach(contributor => {
                        const contributorElement = document.createElement('div');
                        contributorElement.className = 'contributor';
                        contributorElement.innerHTML = `
                            <img src="${contributor.avatar_url}&s=80" alt="${contributor.login}" class="contributor-avatar">
                            <span class="contributor-name">${contributor.login}</span>
                        `;
                        contributorElement.onclick = () => window.open(contributor.html_url, '_blank');
                        container.appendChild(contributorElement);
                    });
                } catch (error) {
                    console.error('加载贡献者数据失败:', error);
                }
            }
            
            // 更新统计数据
            function updateStats() {
                document.getElementById('total-modules').textContent = allModules.length;
                document.getElementById('adapter-count').textContent = allAdapters.length;
                document.getElementById('cli-count').textContent = allCliExtensions.length;
                document.getElementById('contributors-count').textContent = '--';
            }
            
            // 渲染模块
            function renderModules() {
                const modulesGrid = document.getElementById('modules-grid');
                modulesGrid.innerHTML = '';
                
                let packagesToShow = [];
                
                // 根据分类筛选
                if (activeCategory === 'all') {
                    packagesToShow = [...allModules, ...allAdapters, ...allCliExtensions];
                } else if (activeCategory === 'modules') {
                    packagesToShow = allModules;
                } else if (activeCategory === 'adapters') {
                    packagesToShow = allAdapters;
                } else if (activeCategory === 'cli') {
                    packagesToShow = allCliExtensions;
                }
                
                // 应用搜索过滤
                if (searchQuery) {
                    const query = searchQuery.toLowerCase();
                    packagesToShow = packagesToShow.filter(pkg => 
                        pkg.name.toLowerCase().includes(query) || 
                        pkg.description.toLowerCase().includes(query)
                    );
                }
                
                // 如果没有模块显示空状态
                if (packagesToShow.length === 0) {
                    modulesGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                            <i class="fas fa-box-open" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;"></i>
                            <h3>未找到匹配的模块</h3>
                            <p>尝试不同的搜索关键词或查看所有模块</p>
                        </div>
                    `;
                    return;
                }
                
                // 渲染模块卡片
                packagesToShow.forEach((pkg, index) => {
                    const card = document.createElement('div');
                    card.className = 'module-card';
                    card.style.animationDelay = `${index * 0.1}s`;
                    
                    // 处理CLI扩展的特殊显示
                    const cliBadge = pkg.type === 'cli' ? '<span class="module-tag">CLI</span>' : '';
                    const commandInfo = pkg.command && pkg.command.length > 0 ? 
                        `<p style="font-size: 0.85rem; margin-top: 0.5rem;"><i class="fas fa-terminal"></i> 命令: ${pkg.command.join(', ')}</p>` : '';
                    
                    card.innerHTML = `
                        <div class="module-header">
                            <div class="module-icon">
                                ${getIconByType(pkg.type)}
                            </div>
                            <div>
                                <h3 class="module-name">${pkg.name}</h3>
                                <div class="module-version">v${pkg.version}</div>
                            </div>
                        </div>
                        <p class="module-desc">${pkg.description}</p>
                        ${commandInfo}
                        ${pkg.tags.length > 0 ? `
                        <div class="module-tags">
                            ${pkg.tags.map(tag => `<span class="module-tag">${tag}</span>`).join('')}
                            ${cliBadge}
                        </div>
                        ` : ''}
                        <div class="module-footer">
                            <div class="module-author">${pkg.author}</div>
                            <div class="module-actions">
                                <button class="module-btn" data-action="install" data-package="${pkg.package}">
                                    <i class="fas fa-download"></i> 安装
                                </button>
                                ${pkg.repository ? `<button class="module-btn" data-action="docs" data-package="${pkg.package}" data-repo="${pkg.repository}">
                                    <i class="fas fa-book"></i> 文档
                                </button>` : ''}
                            </div>
                        </div>
                    `;
                    
                    modulesGrid.appendChild(card);
                });
                
                // 添加事件监听器
                document.querySelectorAll('[data-action="install"]').forEach(btn => {
                    btn.addEventListener('click', () => showInstallModal(btn.dataset.package));
                });
                
                document.querySelectorAll('[data-action="docs"]').forEach(btn => {
                    btn.addEventListener('click', () => showDocsModal(btn.dataset.package, btn.dataset.repo));
                });
            }
            
            // 根据类型获取图标
            function getIconByType(type) {
                const icons = {
                    'module': '<i class="fas fa-puzzle-piece"></i>',
                    'adapter': '<i class="fas fa-plug"></i>',
                    'cli': '<i class="fas fa-terminal"></i>'
                };
                return icons[type] || '<i class="fas fa-box"></i>';
            }
            
            // 显示安装模态框
            function showInstallModal(packageName) {
                const pkg = [...allModules, ...allAdapters, ...allCliExtensions].find(m => m.package === packageName);
                if (!pkg) return;
                
                const modal = document.getElementById('module-modal');
                const modalContent = document.getElementById('module-modal-content');
                
                modalContent.innerHTML = `
                    <h3>${pkg.name} v${pkg.version}</h3>
                    <p>${pkg.description}</p>
                    
                    <h4 style="margin-top: 1.5rem;">安装命令</h4>
                    <pre style="background: var(--bg); padding: 1rem; border-radius: var(--radius);"><code>epsdk install ${pkg.package}</code></pre>
                    
                    ${pkg.type === 'cli' && pkg.command && pkg.command.length > 0 ? `
                    <h4 style="margin-top: 1.5rem;">可用命令</h4>
                    <ul>
                        ${pkg.command.map(cmd => `<li><code>epsdk ${cmd}</code></li>`).join('')}
                    </ul>
                    ` : ''}
                    
                    ${pkg.tags.length > 0 ? `
                    <h4 style="margin-top: 1.5rem;">标签</h4>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${pkg.tags.map(tag => `<span class="module-tag">${tag}</span>`).join('')}
                    </div>
                    ` : ''}
                    
                    ${pkg.repository ? `
                    <h4 style="margin-top: 1.5rem;">仓库信息</h4>
                    <p><a href="${pkg.repository}" target="_blank">查看源代码</a></p>
                    ` : ''}
                `;
                
                modal.classList.add('active');
            }
            
            function showDocsModal(packageName, repoUrl) {
                const pkg = [...allModules, ...allAdapters, ...allCliExtensions].find(m => m.package === packageName);
                if (!pkg || !repoUrl) return;
                
                const modal = document.getElementById('module-modal');
                const modalContent = document.getElementById('module-modal-content');
                
                modalContent.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div class="loader-spinner"></div>
                        <p>正在加载文档...</p>
                    </div>
                `;
                
                modal.classList.add('active');
                
                // 从GitHub获取README内容
                fetchReadmeContent(repoUrl).then(markdown => {
                    // 使用marked.js将Markdown转换为HTML
                    const htmlContent = marked.parse(markdown);
                    
                    modalContent.innerHTML = `
                        <div class="markdown-content">
                            <h3>${pkg.name} v${pkg.version}</h3>
                            ${htmlContent}
                        </div>
                    `;
                }).catch(error => {
                    console.error('获取文档失败:', error);
                    modalContent.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>
                            <h3>无法加载文档</h3>
                            <p>请访问 <a href="${pkg.repository}" target="_blank">模块仓库</a> 查看文档</p>
                        </div>
                    `;
                });
            }

            async function fetchReadmeContent(repoUrl) {
                try {
                    // 解析GitHub仓库URL
                    const repoPath = repoUrl.replace('https://github.com/', '');
                    const [owner, repo] = repoPath.split('/');
                    
                    // 首先获取仓库信息以确定默认分支
                    const repoInfo = await fetch(`https://api.github.com/repos/${owner}/${repo}`);
                    const repoData = await repoInfo.json();
                    const defaultBranch = repoData.default_branch;
                    
                    // 使用GitHub Raw内容API获取README.md
                    const readmeUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${defaultBranch}/README.md`;
                    const response = await fetch(readmeUrl);
                    
                    if (!response.ok) {
                        throw new Error('README文件不存在或无法访问');
                    }
                    
                    return await response.text();
                } catch (error) {
                    console.error('获取README失败:', error);
                    throw error;
                }
            }
            
            // 显示错误信息
            function showError(message) {
                const modulesGrid = document.getElementById('modules-grid');
                modulesGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger); margin-bottom: 1rem;"></i>
                        <h3>${message}</h3>
                        <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: var(--primary); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                            重新加载
                        </button>
                    </div>
                `;
            }
            
            // 分类按钮事件
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    activeCategory = this.dataset.category;
                    renderModules();
                });
            });
            
            // 搜索功能
            const searchInput = document.getElementById('module-search');
            searchInput.addEventListener('input', function() {
                searchQuery = this.value.trim();
                renderModules();
            });
            
            // 关闭模态框
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('module-modal').classList.remove('active');
            });
            
            // 点击模态框外部关闭
            document.getElementById('module-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
            
            // 如果当前是模块市场视图，加载模块数据
            if (document.getElementById('market-view').classList.contains('active')) {
                loadModuleData();
            }
        });
    </script>
</body>
</html>